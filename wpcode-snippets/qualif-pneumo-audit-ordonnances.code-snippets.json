{"generator":"Code Snippets v3.9.2","date_created":"2025-11-23 19:02","snippets":[{"id":13,"name":"Qualif Pneumo Audit Ordonnances","code":"\/**\n * \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n * QUALIF PNEUMO ORDONNANCES - AUDIT v1.0\n * \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n * \n * \ud83d\udccb Shortcode : [qualif_pneumo_ordonnances_audit]\n * \ud83d\udd0d Recherche par date et\/ou heure\n * \ud83d\udd10 Prot\u00e9g\u00e9 par mot de passe WordPress\n * \ud83d\udd0e Zoom intelligent avec localStorage\n * \n * \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n *\/\n\nif (!function_exists('qpo_audit_shortcode')) {\n    function qpo_audit_shortcode() {\n        global $wpdb;\n        $config = qpo_get_config();\n        $table = $wpdb->prefix . $config['table_bdd'];\n        \n        \/\/ Recherche\n        $results = array();\n        $search_date = '';\n        $search_time = '';\n        \n        if (isset($_POST['qpo_audit_search'])) {\n            $search_date = sanitize_text_field($_POST['search_date']);\n            $search_time = sanitize_text_field($_POST['search_time']);\n            \n            if ($search_time) {\n                $datetime_start = $search_date . ' ' . $search_time . ':00';\n                $datetime_end = $search_date . ' ' . $search_time . ':59';\n                $results = $wpdb->get_results($wpdb->prepare(\n                    \"SELECT * FROM $table WHERE created_at BETWEEN %s AND %s ORDER BY created_at DESC\",\n                    $datetime_start,\n                    $datetime_end\n                ));\n            } else {\n                $date_start = $search_date . ' 00:00:00';\n                $date_end = $search_date . ' 23:59:59';\n                $results = $wpdb->get_results($wpdb->prepare(\n                    \"SELECT * FROM $table WHERE created_at BETWEEN %s AND %s ORDER BY created_at DESC\",\n                    $date_start,\n                    $date_end\n                ));\n            }\n        }\n        \n        ob_start();\n        ?>\n        <style>\n            .qpo-audit-wrapper {\n                max-width: 1200px;\n                margin: 0 auto;\n                padding: 20px;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                transition: zoom 0.2s ease;\n                position: relative;\n            }\n            \n            \/* ZOOM *\/\n            .qpo-audit-zoom-controls {\n                position: absolute;\n                top: 20px;\n                right: 20px;\n                z-index: 1000;\n                background: white;\n                border-radius: 12px;\n                box-shadow: 0 4px 20px rgba(0,0,0,0.2);\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                border: 3px solid <?php echo $config['couleur_primaire']; ?>;\n            }\n            \n            .qpo-audit-zoom-btn {\n                width: 45px;\n                height: 45px;\n                border: none;\n                background: linear-gradient(135deg, <?php echo $config['couleur_primaire']; ?> 0%, <?php echo $config['couleur_secondaire']; ?> 100%);\n                color: white;\n                font-size: 24px;\n                font-weight: 900;\n                border-radius: 8px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            \n            .qpo-audit-zoom-btn:hover {\n                transform: scale(1.1);\n            }\n            \n            .qpo-audit-zoom-value {\n                text-align: center;\n                font-size: 13px;\n                font-weight: 800;\n                color: <?php echo $config['couleur_primaire']; ?>;\n                padding: 4px 0;\n                cursor: pointer;\n            }\n            \n            .qpo-audit-header {\n                background: linear-gradient(135deg, <?php echo $config['couleur_primaire']; ?>, <?php echo $config['couleur_secondaire']; ?>);\n                padding: 30px;\n                border-radius: 12px;\n                margin-bottom: 30px;\n                box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            }\n            .qpo-audit-title {\n                margin: 0;\n                font-size: 28px;\n                color: white;\n                font-weight: 700;\n            }\n            .qpo-audit-subtitle {\n                margin: 8px 0 0 0;\n                font-size: 14px;\n                color: rgba(255,255,255,0.9);\n            }\n            .qpo-audit-search-form {\n                background: white;\n                padding: 25px;\n                border-radius: 12px;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                margin-bottom: 30px;\n            }\n            .qpo-audit-search-grid {\n                display: grid;\n                grid-template-columns: 1fr 1fr 200px;\n                gap: 15px;\n                align-items: end;\n            }\n            .qpo-audit-field {\n                display: flex;\n                flex-direction: column;\n            }\n            .qpo-audit-label {\n                font-size: 13px;\n                font-weight: 600;\n                color: #64748b;\n                margin-bottom: 6px;\n                text-transform: uppercase;\n            }\n            .qpo-audit-input {\n                padding: 12px;\n                border: 2px solid #e2e8f0;\n                border-radius: 8px;\n                font-size: 15px;\n            }\n            .qpo-audit-input:focus {\n                outline: none;\n                border-color: <?php echo $config['couleur_primaire']; ?>;\n            }\n            .qpo-audit-btn {\n                padding: 12px 24px;\n                background: <?php echo $config['couleur_primaire']; ?>;\n                color: white;\n                border: none;\n                border-radius: 8px;\n                font-size: 15px;\n                font-weight: 700;\n                cursor: pointer;\n                transition: all 0.3s;\n            }\n            .qpo-audit-btn:hover {\n                background: <?php echo $config['couleur_secondaire']; ?>;\n                transform: translateY(-2px);\n            }\n            .qpo-audit-results {\n                display: flex;\n                flex-direction: column;\n                gap: 25px;\n            }\n            .qpo-audit-card {\n                background: white;\n                border-radius: 12px;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                overflow: hidden;\n            }\n            .qpo-audit-card-header {\n                background: <?php echo $config['couleur_primaire']; ?>;\n                color: white;\n                padding: 18px 25px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n            .qpo-audit-card-time {\n                font-size: 18px;\n                font-weight: 700;\n            }\n            .qpo-audit-card-id {\n                font-size: 13px;\n                opacity: 0.9;\n            }\n            .qpo-audit-card-body {\n                padding: 25px;\n            }\n            .qpo-audit-section {\n                margin-bottom: 20px;\n            }\n            .qpo-audit-section-title {\n                font-size: 16px;\n                font-weight: 700;\n                color: #1e293b;\n                margin-bottom: 15px;\n                padding-bottom: 8px;\n                border-bottom: 2px solid #e2e8f0;\n            }\n            .qpo-audit-grid {\n                display: grid;\n                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n                gap: 15px;\n            }\n            .qpo-audit-item {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n            .qpo-audit-item-label {\n                font-size: 12px;\n                color: #64748b;\n                font-weight: 600;\n                text-transform: uppercase;\n            }\n            .qpo-audit-item-value {\n                font-size: 15px;\n                color: #1e293b;\n                font-weight: 600;\n            }\n            .qpo-audit-notes-section {\n                margin-top: 20px;\n                padding-top: 20px;\n                border-top: 2px solid #e2e8f0;\n            }\n            .qpo-audit-notes-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 15px;\n            }\n            .qpo-audit-notes-title {\n                font-size: 16px;\n                font-weight: 700;\n                color: <?php echo $config['couleur_primaire']; ?>;\n                text-transform: uppercase;\n            }\n            .qpo-audit-copy-btn {\n                padding: 10px 20px;\n                background: <?php echo $config['couleur_primaire']; ?>;\n                color: white;\n                border: none;\n                border-radius: 8px;\n                font-size: 14px;\n                font-weight: 700;\n                cursor: pointer;\n            }\n            .qpo-audit-notes {\n                background: #f8fafc;\n                border: 2px solid #cbd5e1;\n                border-radius: 8px;\n                padding: 18px;\n                white-space: pre-wrap;\n                font-family: 'Courier New', monospace;\n                font-size: 14px;\n                line-height: 1.7;\n                color: #1e293b;\n                font-weight: 600;\n            }\n            .qpo-audit-no-results {\n                text-align: center;\n                padding: 40px;\n                background: #f8fafc;\n                border-radius: 12px;\n                color: #64748b;\n                font-size: 16px;\n            }\n        <\/style>\n\n        <div class=\"qpo-audit-wrapper\" id=\"qpo-audit-wrapper\">\n            <div class=\"qpo-audit-zoom-controls\">\n                <button type=\"button\" class=\"qpo-audit-zoom-btn\" id=\"qpo-audit-zoom-plus\">+<\/button>\n                <div class=\"qpo-audit-zoom-value\" id=\"qpo-audit-zoom-display\">90%<\/div>\n                <button type=\"button\" class=\"qpo-audit-zoom-btn\" id=\"qpo-audit-zoom-minus\">\u2212<\/button>\n            <\/div>\n            \n            <div class=\"qpo-audit-header\">\n                <h1 class=\"qpo-audit-title\">\ud83d\udd0d Audit Demandes Pneumo<\/h1>\n                <p class=\"qpo-audit-subtitle\">Recherche et consultation des demandes enregistr\u00e9es<\/p>\n            <\/div>\n            \n            <div class=\"qpo-audit-search-form\">\n                <form method=\"POST\">\n                    <div class=\"qpo-audit-search-grid\">\n                        <div class=\"qpo-audit-field\">\n                            <label class=\"qpo-audit-label\">\ud83d\udcc5 Date<\/label>\n                            <input type=\"date\" name=\"search_date\" class=\"qpo-audit-input\" \n                                   value=\"<?php echo $search_date ? $search_date : date('Y-m-d'); ?>\" required>\n                        <\/div>\n                        <div class=\"qpo-audit-field\">\n                            <label class=\"qpo-audit-label\">\ud83d\udd50 Heure (optionnel)<\/label>\n                            <input type=\"time\" name=\"search_time\" class=\"qpo-audit-input\" \n                                   value=\"<?php echo $search_time; ?>\">\n                        <\/div>\n                        <div class=\"qpo-audit-field\">\n                            <label class=\"qpo-audit-label\">&nbsp;<\/label>\n                            <button type=\"submit\" name=\"qpo_audit_search\" class=\"qpo-audit-btn\">\n                                \ud83d\udd0d Rechercher\n                            <\/button>\n                        <\/div>\n                    <\/div>\n                <\/form>\n            <\/div>\n            \n            <?php if (isset($_POST['qpo_audit_search'])): ?>\n                <?php if (empty($results)): ?>\n                    <div class=\"qpo-audit-no-results\">\n                        Aucune demande trouv\u00e9e pour cette date\/heure.\n                    <\/div>\n                <?php else: ?>\n                    <div class=\"qpo-audit-results\">\n                        <?php foreach ($results as $r): ?>\n                            <div class=\"qpo-audit-card\">\n                                <div class=\"qpo-audit-card-header\">\n                                    <div class=\"qpo-audit-card-time\">\n                                        \u23f0 <?php echo date('H:i:s', strtotime($r->created_at)); ?>\n                                    <\/div>\n                                    <div class=\"qpo-audit-card-id\">\n                                        ID #<?php echo $r->id; ?>\n                                    <\/div>\n                                <\/div>\n                                \n                                <div class=\"qpo-audit-card-body\">\n                                    <div class=\"qpo-audit-section\">\n                                        <div class=\"qpo-audit-section-title\">\ud83d\udccb Informations<\/div>\n                                        <div class=\"qpo-audit-grid\">\n                                            <div class=\"qpo-audit-item\">\n                                                <span class=\"qpo-audit-item-label\">M\u00e9decin<\/span>\n                                                <span class=\"qpo-audit-item-value\"><?php echo $r->medecin_destinataire; ?><\/span>\n                                            <\/div>\n                                            <div class=\"qpo-audit-item\">\n                                                <span class=\"qpo-audit-item-label\">Type<\/span>\n                                                <span class=\"qpo-audit-item-value\"><?php echo $r->type_demande; ?><\/span>\n                                            <\/div>\n                                            <div class=\"qpo-audit-item\">\n                                                <span class=\"qpo-audit-item-label\">Motif<\/span>\n                                                <span class=\"qpo-audit-item-value\"><?php echo $r->motif_demande; ?><\/span>\n                                            <\/div>\n                                        <\/div>\n                                    <\/div>\n                                    \n                                    <div class=\"qpo-audit-notes-section\">\n                                        <div class=\"qpo-audit-notes-header\">\n                                            <h3 class=\"qpo-audit-notes-title\">\ud83d\udccb Email envoy\u00e9<\/h3>\n                                            <button type=\"button\" class=\"qpo-audit-copy-btn\" onclick=\"copyNotes<?php echo $r->id; ?>()\">\n                                                \ud83d\udccb Copier\n                                            <\/button>\n                                        <\/div>\n                                        <pre id=\"notes-<?php echo $r->id; ?>\" class=\"qpo-audit-notes\"><?php echo esc_html($r->notes_email); ?><\/pre>\n                                        <script>\n                                        function copyNotes<?php echo $r->id; ?>() {\n                                            const text = document.getElementById('notes-<?php echo $r->id; ?>').textContent;\n                                            navigator.clipboard.writeText(text).then(function() {\n                                                alert('\u2705 Notes copi\u00e9es !');\n                                            });\n                                        }\n                                        <\/script>\n                                    <\/div>\n                                    \n                                    <?php if ($r->email_sent): ?>\n                                        <div style=\"margin-top: 15px; padding: 10px; background: #d1fae5; border-radius: 6px; font-size: 12px; color: #065f46;\">\n                                            \u2705 Email envoy\u00e9 le <?php echo date('d\/m\/Y \u00e0 H:i', strtotime($r->email_sent_at)); ?>\n                                        <\/div>\n                                    <?php endif; ?>\n                                <\/div>\n                            <\/div>\n                        <?php endforeach; ?>\n                    <\/div>\n                <?php endif; ?>\n            <?php endif; ?>\n        <\/div>\n        \n        <script>\n        (function() {\n            'use strict';\n            const STORAGE_KEY = 'qualif_pneumo_ordonnances_audit_zoom';\n            let currentZoom = parseFloat(localStorage.getItem(STORAGE_KEY)) || 0.9;\n            \n            function updateZoom(newZoom) {\n                currentZoom = Math.max(0.5, Math.min(1.5, newZoom));\n                document.getElementById('qpo-audit-wrapper').style.zoom = currentZoom;\n                document.getElementById('qpo-audit-zoom-display').textContent = Math.round(currentZoom * 100) + '%';\n                localStorage.setItem(STORAGE_KEY, currentZoom);\n            }\n            \n            updateZoom(currentZoom);\n            \n            document.getElementById('qpo-audit-zoom-plus').addEventListener('click', function() {\n                updateZoom(currentZoom + 0.1);\n            });\n            \n            document.getElementById('qpo-audit-zoom-minus').addEventListener('click', function() {\n                updateZoom(currentZoom - 0.1);\n            });\n            \n            document.getElementById('qpo-audit-zoom-display').addEventListener('dblclick', function() {\n                updateZoom(0.9);\n            });\n        })();\n        <\/script>\n        <?php\n        return ob_get_clean();\n    }\n}\n\nadd_shortcode('qualif_pneumo_ordonnances_audit', 'qpo_audit_shortcode');","tags":["audit","qualif-pneumo"],"active":true,"modified":"2025-11-19 12:47:43","revision":"1"}]}